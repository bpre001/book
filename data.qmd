# Data

## Goal

The objective of this project is to produce 3-day forecasts of net energy use for the Cohaus residential development of 20 apartments at 11-13 Surrey Crescent, Grey Lynn, Auckland.

## Data Source

Cohaus was completed in July 2021 and teh community moved in shortly thereafter,, Cohaus has installed solar generation capacity that is applied locally, and if any surplus remains is sold back to the electricity retailer. The data for this project has been collected from the residential development itself (of which the author is an owner-resident). Half hourly kWh electricity use and generation measures are as follows:

-   `APT` aggregated apartment electricity use

-   `CS` common services (lighting, laundry, bike shed, garden house)

-   `EV` electric vehicle chargers

-   `HP` centralised hot water and heat pumps

-   `PV` photo-voltaic electricity generation

Net energy use (i.e. drawn from the grid) is calculated by summing the five measures.

```{r library, message=FALSE}

library(tidyverse)
library(readxl)
library(fpp3)
library(GGally)

```



```{r cohaus, message=FALSE}

# read in cohaus_wide (painful wrangle is in separate wrangle.R)
cohaus_wide <- read_rds("data/cohaus_wide.rds")

cohaus_long <- cohaus_wide |> 
  pivot_longer(cols = -dttm, names_to = "Name", values_to = "Value")

cohaus_ts <- cohaus_wide |> as_tsibble(index = dttm)

```

```{r plots, messages = FALSE}

cohaus_ts |> 
  gg_tsdisplay(PV, plot_type = "partial")


cohaus_wide |> 
  select(APT,EV,CS,HP,PV) |> 
  ggpairs(progress = FALSE)

cohaus_wide |> 
  select(Sink,PV,AT) |> 
  ggpairs(progress = FALSE)


```

```{r}

qtrDummy <- function(x,y) {
  ifelse(quarter(x) == y, 1, 0)
}

cohaus_ts <- cohaus_ts |> 
  mutate(qtr1 = qtrDummy(dttm,1),
         qtr2 = qtrDummy(dttm,2),
         qtr3 = qtrDummy(dttm,3),
         qtr4 = qtrDummy(dttm,4)
         )

cohaus_ts |>
  ggplot(aes(x = hour(dttm), y = -PV)) +
  geom_point(alpha = 0.1, col = "gold") +
  facet_wrap(~month(dttm))
  
cohaus_ts |>
  ggplot(aes(x = hour(dttm), y = Sink)) +
  geom_point(alpha = 0.1, col = "blue") +
  facet_wrap(~month(dttm))  

cohaus_ts |>
  ggplot(aes(x = hour(dttm), y = Tdry)) +
  geom_point(alpha = 0.05, col = "red") +
  facet_wrap(~month(dttm))  
  
  
fit <- cohaus_ts |>
  model(snaive = SNAIVE(PV ~ lag("week")),
        lm = TSLM(PV ~ season() + qtr2 + qtr3 + qtr4 + workDay + sunUp + Tdry)
        )

fit |> select(.model = lm) |> report()

fit |> select(.model = snaive) |> 
  forecast(h = 24*3) |> 
  autoplot()


```

```{r}
  
  
  
```

```{r}


```

